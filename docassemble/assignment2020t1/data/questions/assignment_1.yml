# ASSIGNMENT 1
# You will be implementing the Legal Aid Bureau's interview to determine
# whether an applicant is eligible for legal aid. 
# The total score that can be awarded for this assignment is 20.
# The reference interview is found here:
# https://guided.page/interview?i=docassemble.playground3%3Alab.yml#page1
# Resources are found here:
# https://lab.mlaw.gov.sg/legal-services/taking-the-means-test/
# https://sso.agc.gov.sg/SL/LAAA1995-RG1#Sc1-
---
# MODIFY THIS BLOCK
# Please fill in the relevant information.
metadata:
  title: |
    Legal Aid Bureau Interview
  short title: |
    SLS Means Test
  description: |
    This means test is to determine whether you qualify for legal aid.
  authors:
    - name: Tan Zay Hua 
      organization: COR-LAW-2215 Digital Intelligence for Lawyers
  revision_date: 2020-10-06
---
modules:
  - docassemble.base.core
  - docassemble.base.util
---
sections:
  - Property Information
  - Savings Information
  - Personal Information
  - Household Member(s) Information
---
features:
  navigation: True
---
images:
  legal aid bureau logo: lab-logo.png
---
initial: True
code: |
  set_language('en', dialect='us')
  speak_text = True
#---
#mandatory: True
#question: |
 # Read more about the Means Test.
#subquestion: |
 # Feel free to
  #[read more](${ https://lab.mlaw.gov.sg/legal-services/taking-the-means-test/ })
  #about this interview before
  #proceeding.
#field: ready_to_proceed
---
question: |
  **Question 1 of 11:** [BR]
  Do you own any property?
field: any_property
choices:
  - Yes
  - No
right: |
  [FILE lab-logo.png, 60%] [BR]
section: Property Information
---
question: |
  **Question 1b of 11:** [BR]
fields:
  - Do you own more than one property?: more_than_one_property
    datatype: yesnoradio
  - Do you currently reside in this property?: reside_property
    datatype: yesnoradio
    show if:
      variable: more_than_one_property
      is: False
  - What is the annual value of your residential property?: value_property
    datatype: currency
    min: 0
    show if:
      variable: reside_property
      is: True
right: |
  [FILE lab-logo.png, 60%] [BR]
section: Property Information
---
mandatory: True
code: |
  if any_property == 'Yes':
    more_than_one_property
    if more_than_one_property == True:
      non_eligible
  else:
    applicant.birthdate
    applicant.total_savings
    applicant.name.first
    review_household_members
  if value_property > 13000:
    non_eligible
  if reside_property == False:
    non_eligible
  # if (user.age_in_years >= 60 and applicant.total_savings > 40000):
    # non_eligible
    # this code does not work, need a python file?
  if applicant.total_savings > 10000:
      non_eligible
---
event: non_eligible
question: |
  Unfortunately, you do not qualify for Legal Aid.
subquestion: |
  If you fail the means test but you have certain reasons or information that you think makes your situation different or special, for example if you have a very serious illness and cannot afford legal services as you need to pay for major medical procedures, you may contact the MinLaw Services Centre for further assistance. https://www.mlaw.gov.sg/about-us/contact-us/
buttons: 
    - Exit: exit
    - Restart: restart
right: |
  [FILE lab-logo.png, 60%] [BR]
---
question: |
  **Question 2 of 11:** [BR]
subquestion: |
  Total savings and non-CPF investments are calculated by adding up the value of the following assets that you own in your name:
  
  a) Bank accounts savings (personal or joint);

  b) Overall value of shares in your Central Depository (CDP) account; and

  c) Any other financial/investment products with a cash value, such as fixed deposit accounts at financial institutions, and shares, bonds and exchange traded funds aside from those in your CDP account.
fields:
  - Enter your birth date: applicant.birthdate
    datatype: date
  - How much total savings and investments do you have?: applicant.total_savings
    datatype: currency
    min: 0
right: |
  [FILE lab-logo.png, 60%] [BR]
section: Savings Information
---
question: |
  You are ${applicant.age_in_years()}
mandatory: True
---
question: |
  **Question 3 of 11:** [BR]
  Please provide your personal details below.
under: |
  Disclaimer: These particulars will be used for the purposes of correspondence with you by the Legal Aid Bureau (if applicable).
fields:
  - First Name (as per NRIC): applicant.name.first
  - Last Name (as per NRIC): applicant.name.last
  - NRIC: applicant.NRIC
    validate: check_nric
  - Your total income in the past 12 months: applicant.income
    datatype: currency
    min: 0
  - Street Number and Name: applicant.address
    address autocomplete: True
  - Apartment Unit: applicant.unit
    required: False
  - Postcode: applicant.postcode
    datatype: integer
  - Country: applicant.country
    code: |
      countries_list()
right: |
  [FILE lab-logo.png, 60%] [BR]
section: Personal Information
---
# DO NOT MODIFY THIS BLOCK. SCORE: 5
# Implement a check_nric function in a module file called validation.py.
# It should check for (1) correct format and (2) that it is a valid NRIC.
# Use a regular expression to test for the correct format.
# Implement the checksum algorithm to determine whether the NRIC is valid.
# The NRIC checksum algorithm can be found on:
# http://www.ngiam.net/NRIC/ or Wikipedia
# Test your function using data from: https://samliew.com/nric-generator
modules:
  .validation
#still need to use NRIC checksum algorithm - ngiam net
# 1. whether nric is correct format
# 2. whether nric is valid
---
# DO NOT MODIFY THIS BLOCK
# This is your objects block.
# Individual is used for the applicant.
# DAList is used for household_incomes.
objects:
  applicant: Individual
  household_members: DAList.using(object_type=Individual, there_is_another=False)
---
# MODIFY THIS BLOCK (BUT DO NOT MOVE IT). SCORE: 5
# Use this block to control the interview logic.
# Include this line somewhere in your code: 
#   household_members.append(applicant)
# This line of code adds the applicant to the household_members DAList.
# This ensures that the applicant appears in the household_members.table.
mandatory: True
code: |
  household_members.clear()
  household_members.append(applicant)
  household_members.gathered = True
  #review_household_members
  #household_members[0].name.first = applicant.name.first
  #household_members[0].name.last = applicant.name.last
  #household_members[0].birthdate = applicant.birthdate
  #household_members.append(applicant)
  #household_members.gathered = True
  #review_household_members
  #household_members.there_are_any = True
  #household_members.gathered = True
---
# DO NOT MODIFY THIS BLOCK
question: | 
  Please add all other household members.
subquestion: |
  A household member is any person residing with you and related by:
  
  1. blood
  2. marriage; or
  3. adoption.
  
  Press continue when you have added all household members.
  
  ${household_members.table}

  ${household_members.add_action() }
  
field: review_household_members
---
# DO NOT MODIFY THIS BLOCK
question: |
  Information about your ${ordinal(i)} household member:
fields:
  - First Name: household_members[i].name.first
  - Last Name: household_members[i].name.last
  - Birthdate: household_members[i].birthdate
    datatype: date
  - "This person's total income in past 12 months": household_members[i].income
    datatype: currency
    min: 0
    default: 0
---
# DO NOT MODIFY THIS BLOCK OR MOVE IT
mandatory: True
code: |
  if household_members.there_are_any:
    review_household_members
---
# DO NOT MODIFY THIS BLOCK
table: household_members.table
rows: household_members
columns: 
  - Name: row_item
  - Birthdate: row_item.birthdate
  - Income: row_item.income
edit:
  - name.first
---
question: |
 **Question 4 of 11:** [BR]
 Does anybody live with you?
subquestion: |
  “Household members” refers to persons related by blood, marriage and/or legal adoption and have the same residential address reflected on the NRIC as the applicant for legal aid.
yesno: household_members.there_are_any
right: |
  [FILE lab-logo.png, 60%] [BR]
section: Household Member(s) Information
---
# MODIFY THIS BLOCK (BUT DO NOT MOVE IT). SCORE: 5
# Use this block to write code that calculates the average PCHI
mandatory: True
code: |
  household_members[i].name.first
  household_members[i].birthdate
  household_members[i].income
  household_members[i].there_is_another = False
  
# if PCHI < 950: eligible
---
question: |
  **Question 5 of 11:** [BR]
  You have a Per Capita Gross Monthly Household Income (PCHI) of ${pchi.income.number()}
subquestion: |
  Your total household income is ${total_household_income.number()}
right: |
  [FILE logo.png, 60%] [BR]
---
mandatory: True
code:
  total_household_income = sum(household_members.income)
  pchi.income = total_household_income / (len(household_members)*12)
  if pchi.income > 950:
    non_eligible
  else:
    yes_eligible
---
event: yes_eligible
question: |
  You qualify for Legal Aid.
buttons: 
    - Exit: exit
    - Restart: restart
right: |
  [FILE logo.png, 60%] [BR]
---
# IMPLEMENT ALL YOUR QUESTION BLOCKS.
# Implement all the question blocks correctly. Score 3
# Improving the usability / user experience. Score 2